<%# locals: form, context, label, topic, url, partial

  :label   - the user friendly name for the :topic
  :context - refers to the parent object and topic refers to the associated object
             the user will be selecting, for example:
                 :context = a ResearchOutput, :topic = "repository"
  :url     - the path to controller endpoint that will perform the search
  :partial - the 'card' that displays the search results, for example:
                 :card = "research_outputs/repository/card"
%>

<div class="external-api-selection col-md-12" external_api="<%= topic %>">
  <div class="col-md-12">
    <%= label_tag label %>
  </div>
  <div class="col-md-12">
    <%= render partial: "shared/external_apis/selection",
               locals: { context: context, topic: topic, partial: partial } %>
  </div>
  <div class="col-md-12">
    <%= button_tag _("%{topic} search") % { topic: label }, type: "button", class: "btn btn-default",
                   data: { toggle: "modal", target: "#external-api-search" } %>
  </div>
</div>

<div id="external-api-search" class="modal fade external-api-search-modal" tabindex="-1"
     role="dialog" aria-labelledby="external-api-search-label" aria-hidden="true"
     external_api="<%= topic %>">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <%= button_tag "X", type: "button", class: "close",
                       data: { dismiss: "modal" }, aria: { label: _("Close") } %>
        <h3 id="external-api-search-label" class="modal-title">
          <%= _("%{topic} search") % { topic: label } %>
        </h3>
      </div>
      <div class="modal-body">
        <div class="form-group row">
          <div class="col-md-12">
            <%= form.label :"#{label.downcase}_search_term", _("Find a %{topic}") % { topic: label.downcase } %>
          </div>
        </div>
        <div class="form-group row">
          <div class="col-md-7">
            <%= form.text_field :"#{label.downcase}_search_term",
                                class: "form-control autocomplete col-md-6",
                                data: { remote: true, url: url, method: :post } %>
          </div>
          <div class="col-md-3">
            <%= link_to _("Search"), "#", class: "btn btn-default external-api-faux-search-button" %>
          </div>
        </div>

        <div class="form-group row external-api-search-results" external_api="<%= topic %>">
          <div class="col-md-12">
            <%= render partial: "shared/external_apis/search_results",
                       locals: { context: context, results: [], partial: partial } %>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <%= button_tag _("Close"), type: "button", class: "close", data: { dismiss: "modal" } %>
      </div>
    </div>
  </div>
</div>
