<% I18n.with_locale I18n.default_locale do %>
  <p>
    <% name = @invitee.email if @invitee.active_invitation? %>
    <% name = (@inviter_type == 'User' ? @invitee.name(false) : @invitee.name) unless name.present? %>
    <%= _('Hello %{invitee}') %{ invitee: name } %>
  </p>
  <p>
    <% case @inviter_type %>
    <% when "ApiClient" %>
      <%# This was an inivitation generated by a 'create_dmps' scope in API V2+ %>
      <%= sanitize(@plan.template.org.api_create_plan_email_body % {
        external_system_name: @client_name
      }) %>

    <% when "Org" %>
      <%# This was an inivitation generated by an OrgAdmin using 'Email template' %>
        <%= sanitize(@plan.template.email_body % {
          dmp_title: @plan.title,
          org_name: @org_name,
          org_admin_email: link_to(@org_email, @org_email)
        }) %>

    <% else %>
    <%# This was an inivitation on the Collaborator section of the Plan pages %>
      <%= _("Your colleague %{inviter_name} has invited you to contribute to their Data Management Plan in %{tool_name}") % {
        tool_name: tool_name,
        inviter_name: @inviter_name
      } %>
    <% end %>
  </p>
  <p>
    <%= sanitize(_("Please sign in or sign up at %{homepage_link}. Once you have signed in you will see the DMP titled '%{dmp_title}' on your dashboard.") % {
      homepage_link: link_to(ApplicationService.application_name, root_url),
      dmp_title: @plan.title
    }) %>
  </p>

  <% if @inviter_type == "User" %>
    <%= render partial: 'email_signature',
               locals: {
                 tool_name: ApplicationService.application_name,
                 helpdesk_email: Rails.configuration.x.helpdesk_email,
                 allow_change_prefs: false
               } %>
  <% else %>
    <br>
    <p><%= _("Thank you,") %></p>
    <p><%= _("The %{org_name} DMP Tool team") % { org_name: @org_name } %></p>
    <p><%= sanitize(_("Please do not reply to this email. If you have any questions or need help, please contact us at %{org_admin_email}") % {
      org_admin_email: mail_to(@org_email, @org_email)
    }) %></p>
  <% end %>
<% end %>
