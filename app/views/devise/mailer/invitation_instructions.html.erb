<%
  tool_name = ApplicationService.application_name
  link = accept_invitation_url(@resource, :invitation_token => @token)
  helpdesk_email = Rails.configuration.x.organisation.helpdesk_email
  contact_us = (Rails.configuration.x.organisation.contact_us_url || contact_us_url)
  email_subject = _('Query or feedback related to %{tool_name}') %{ :tool_name => tool_name }
  user_name = @resource.email
  inviter = @resource.invited_by
  plan = Plan.find_by(id: @resource.invitation_plan_id)
  org = plan.template.org
%>
<% I18n.with_locale I18n.default_locale do %>
  <p>
    <%= _('Hello %{user_name}') %{ :user_name => user_name } %>
  </p>
  <p>
    <% if inviter.is_a?(Org) %>
      <%# This was an inivitation generated by an OrgAdmin using 'Email template' %>
      <%= sanitize(plan.template.email_body % {
        dmp_title: plan.title,
        org_name: inviter.name,
        org_admin_email: link_to(inviter.contact_email, inviter.contact_email)
      }) %>

    <% elsif inviter.is_a?(ApiClient) %>
      <%# This was an inivitation generated by a 'create_dmps' scope in API V2+ %>
      <%= sanitize(plan.template.org.api_create_plan_email_body % {
        external_system_name: inviter.description
      }) %>

    <% else %>
      <%# This was an inivitation on the Collaborator section of the Plan pages %>
      <%= _("Your colleague %{inviter_name} has invited you to contribute to "\
              " their Data Management Plan in %{tool_name}") % {
        tool_name: tool_name,
        inviter_name: inviter&.name(false)
      } %>
    <% end %>
  </p>

  <% if inviter.is_a?(User) %>
    <p>
      <%= sanitize(_('%{click_here} to accept the invitation, (or copy %{link} into your browser). If you don\'t want to accept the invitation, please ignore this email.') % {
        click_here: link_to(_('Click here'), link), link: link
      }) %>
    </p>
    <%= render partial: 'user_mailer/email_signature', locals: { allow_change_prefs: false } %>
  <% else %>
    <p>
      <%= sanitize(_("%{click_here} to setup your account (or copy %{link} into your browser). Once you have signed in, you can begin filling out your DMP.") % {
        click_here: link_to(_('Click here'), link), link: link
      }) %>
    </p>
    <br>
    <p><%= _("Thank you,") %></p>
    <p><%= _("The %{org_name} DMPTool team") % { org_name: org&.name } %></p>
    <p><%= _("Please do not reply to this email. If you have any questions or need help, please contact us at %{org_admin_email}") % {
      org_admin_email: link_to(org&.contact_email, org&.contact_email)
    } %></p>
  <% end %>
<% end %>
