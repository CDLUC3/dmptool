<%# locals: api_client, user %>

<br>
<h3><%= _("Register your application/system") %></h3>
<hr>

<%
  url = api_client.new_record? ? api_clients_path : api_client_path(api_client)
  method = api_client.new_record? ? :post : :put

  name_tooltip = _("The name of your application/system that will interact with the %{application_name}'s API") % { application_name: "DMPTool" }
  description_tooltip = _("Please provide a brief description of your system and the purpose of the intgeration.")
  redirect_uri_tooltip = _("A redirect URI is the address that will be sent the user's OAuth authorization code. If you have multiple URIs, pllease place them on inidividual lines. The redirect_uri you specify in your calls to the API must match one of the ones you define here.")
  callback_uri_tooltip = _("An API endpoint on your application/system that we can use to notify you when a DMP is updated. You will receive notifications of updates to any DMPs you create, download or update.")
%>
<%= form_for api_client, url: url, method: method, remote: true, html: { class: 'api_client' } do |f| %>
  <div class="row">
    <div class="form-group col-xs-4">
      <%= f.label :name, _('Application Name'), class: 'control-label' %>
      <%= f.text_field :name, class: 'form-control', aria: { required: true }, data: { toggle: "tooltip" },
                              title: name_tooltip %>
    </div>
    <div class="form-group col-xs-4">
      <%= f.label :homepage, _('Homepage'), class: 'control-label' %>
      <%= f.url_field :homepage, class: 'form-control', aria: { required: true } %>
    </div>
  </div>
  <div class="row">
    <div class="form-group col-xs-8">
      <%= f.label :description, _('Description'), class: 'control-label' %>
      <%= f.text_area :description, class: 'form-control api-client-text' %>
    </div>
  </div>
  <div class="row" id="api-client-credentials">
    <div class="form-group col-xs-4">
      <%= f.label :contact_name, _('Contact Name'), class: 'control-label' %>
      <%= f.text_field :contact_name, class: 'form-control' %>
    </div>
    <div class="form-group col-xs-4">
      <%= f.label :contact_email, _('Contact Email'), class: 'control-label' %>
      <%= f.email_field :contact_email, class: 'form-control' %>
    </div>
  </div>
  <% unless api_client.new_record? %>
    <div class="row" id="api-client-credentials">
      <div class="form-group col-xs-4">
        <%= f.label :client_id, _('Client ID'), class: 'control-label' %>
        <%= f.text_field :client_id, class: 'form-control', disabled: true %>
      </div>
      <div class="form-group col-xs-4">
        <%= f.label :client_secret, _('Client Secret'), class: 'control-label' %>
        <%= f.text_field :client_secret, class: 'form-control', disabled: true %>
      </div>
    </div>
  <% end %>

  <div class="row">
    <div class="form-group col-xs-8">
      <%= _("This system supports the OAuth2 authorization standard. Please define you OAuth2 compliant redirect URIs below to acquire user authorization codes. If you leave this section blank, you will still be able to access the 'public' API.") %>
    </div>
  </div>
  <div class="row">
    <div class="form-group col-xs-4">
      <%= f.label :redirect_uri, _('Redirect URI(s)'), class: 'control-label' %>
      <%= f.text_area :redirect_uri, class: 'form-control', rows: 3,
                                     placeholder: 'http://localhost:3000/oauth2/callback',
                                     data: { toggle: "tooltip" }, title: redirect_uri_tooltip %>
    </div>
  </div>

  <div class="form-group row api-client-controls">
    <div class="col-md-8">
      <%= f.hidden_field :user_id %>
      <%= f.hidden_field :org_id, value: user.org_id %>

      <%= f.button _('Save'), class: 'btn btn-default', type: 'submit' %>

      <% unless api_client.new_record? %>
        <%= link_to _("Refresh client secret"),
                    refresh_credentials_api_client_path(id: api_client),
                    class: "btn btn-default", remote: true %>
      <% end %>
    </div>
    <div class="col-md-8 refresh-response"></div>
  </div>
<% end %>