<!DOCTYPE html>
<html lang="en">
  <head>
    <% if Rails.configuration.x.google_analytics.tracker_root.present? %>
      <% root_abbr = Rails.configuration.x.google_analytics.tracker_root %>
      <% root_org = Org.where(abbreviation: root_abbr).first %>
      <% if root_org.tracker.present? %>
        <% root_code = root_org.tracker.code %>
        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
             m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
           })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', '<%=root_code%>', 'auto');
          ga('send', 'pageview');
          <% if current_user.present? and current_user.org.present? %>
            <% client_org = current_user.org %>
            <% if client_org.tracker.present? %>
              <% client_code = client_org.tracker.code %>
              <% unless root_code == client_code %>
                ga('create', '<%=client_code%>', 'auto','clientTracker');
                ga('clientTracker.send', 'pageview');
              <% end %>
            <% end %>
          <% end %>
        </script>
      <% end %>
    <% end %>
    <!-- End Google Analytics -->
    <title><%= content_for?(:title) ? yield(:title) : _('%{application_name}') % { :application_name => ApplicationService.application_name } %>
    </title>
    <%= favicon_link_tag "favicon.ico" %>
    <!--[ if lte IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js"></script>
         <style type="text/css">
           .navbar {
             filter:none !important;
           }
         </style>
    <![endif]-->

    <!--[if gte IE 9]>
        <style type="text/css">
          .gradient {
               filter: none;
          }
        </style>
    <![endif]-->

    <!--[if IE]>
          <script>
            $(function() {
              // Invoke the plugin
              $('input, textarea').placeholder();
              $('input, iframe').placeholder();
          });
        </script>
    <![endif]-->

    <%= stylesheet_link_tag(stylesheet_manifest_file) %>
    <%= javascript_pack_tag "application", "data-turbolinks-track": "reload" %>
    <%= csrf_meta_tags %>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  </head>
  <body class="<%= active_page?(root_path, true) ? "t-home" : "t-generic" %>">

    <a href="#maincontent" class="c-skipnav">Skip to main content</a>

    <!-- header rendering -->
    <header><%= render partial: "layouts/header" %></header>

    <main id="maincontent" class="<%= @main_class %>">

      <%= render partial: "layouts/notifications", locals: local_assigns %>

      <%= yield %>

      <%# Generic UJS/Ajax spinner. Bootstrap 5+ has built in spinner for this class %>
      <div class="spinner-border hidden" role="status">
        <% spinner_msg = _("Loading...") %>
        <%= image_tag("spinner.gif", alt: spinner_msg) %>
        <span class="sr-only"><%= spinner_msg %></span>
      </div>

    </main>

    <footer ><%= render "layouts/footer" %></footer>

    <%= render partial: "layouts/json_constants" %>

  </body>
</html>
